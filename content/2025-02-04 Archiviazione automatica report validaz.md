---
{"publish":true,"created":"2025-10-15T20:56:24.537+02:00","modified":"2025-10-15T20:56:24.540+02:00","cssclasses":""}
---


## La Novitade

### Meta

- Cache retroattiva per il generatore di csv che funziona recuperando gli omid già contenuti nei file di output, salvandoli su un redis e saltando i file bibliografici relativi nelle nuove elaborazioni.
- è ora possibile specificare come unico identificativo un identificatore temporaneo che comincia con `temp:`. Questo identificatore viene usato per la deduplicazione all’interno del file e per la generazione di un OMID, ma non viene salvato nel triplestore. Ho testato questa funzionalità.
    - Ho poi documentato questa nuova possibilità nel readme del repositore di crowdsourcing.
- Risolto un bug nello script che carica i dati su Figshare, occorreva un’ulteriore chiamata esplicita all’API per confermare la fine dell’upload ad upload terminato. Le API di Figshare si confermano come le più complicate che ho utilizzato finora, persino più complicate di quelle di Google.
- El dump
    - RDF: https://doi.org/10.6084/m9.figshare.21747536.v8
    - CSV: https://doi.org/10.6084/m9.figshare.21747461.v10

### text2rdf

### crowdsourcing

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1295.8333px" preserveAspectRatio="none" style="width:1236px;height:1295px;background:#FFFFFF;" version="1.1" viewBox="0 0 1236 1295" width="1236.4583px" zoomAndPan="magnify"><title>Crowdsourcing Workflow for OpenCitations</title><defs><linearGradient id="g11uxd1q54az3m0" x1="0%" x2="100%" y1="0%" y2="100%"><stop offset="0%" stop-color="#000080"/><stop offset="100%" stop-color="#FFFFFF"/></linearGradient></defs><g><rect fill="#FFFFFF" fill-opacity="0.00000" height="47.168" id="_title" rx="4.1667" ry="4.1667" style="stroke:#000080;stroke-width:1.0417;" width="531.2785" x="351.5462" y="20.8333"/><text fill="#000080" font-family="Arial" font-size="20.8333" font-weight="bold" lengthAdjust="spacing" textLength="508.3618" x="363.0046" y="51.6296">Crowdsourcing Workflow for OpenCitations</text><g><title>&lt;color:#000080&gt;OpenCitations&lt;/color&gt;</title><rect fill="#FFFFFF" fill-opacity="0.00000" height="121.7448" style="stroke:#000080;stroke-width:1.0417;" width="10.4167" x="758.9742" y="882.8776"/></g><rect fill="#FFFFFF" fill-opacity="0.00000" height="302.7995" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0417;" width="690.7135" x="20.8333" y="453.0924"/><rect fill="#FFFFFF" fill-opacity="0.00000" height="188.3464" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0417;" width="652.5116" x="302.3855" y="824.6094"/><rect fill="#FFFFFF" fill-opacity="0.00000" height="87.4023" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0417;" width="513.4491" x="701.1302" y="1081.6732"/><g><title>Trusted Agent</title><rect fill="#FFFFFF" fill-opacity="0.00000" height="1017.7734" width="8.3333" x="79.7709" y="169.0104"/><line style="stroke:#000080;stroke-width:1.0417;stroke-dasharray:5.0,5.0;" x1="83.3333" x2="83.3333" y1="169.0104" y2="1186.7839"/></g><g><title>GitHub</title><rect fill="#FFFFFF" fill-opacity="0.00000" height="1017.7734" width="8.3333" x="363.6271" y="169.0104"/><line style="stroke:#000080;stroke-width:1.0417;stroke-dasharray:5.0,5.0;" x1="366.9688" x2="366.9688" y1="169.0104" y2="1186.7839"/></g><g><title>CSV Validator</title><rect fill="#FFFFFF" fill-opacity="0.00000" height="1017.7734" width="8.3333" x="620.8171" y="169.0104"/><line style="stroke:#000080;stroke-width:1.0417;stroke-dasharray:5.0,5.0;" x1="624.8789" x2="624.8789" y1="169.0104" y2="1186.7839"/></g><g><title>&lt;color:#000080&gt;OpenCitations&lt;/color&gt;</title><rect fill="#FFFFFF" fill-opacity="0.00000" height="1017.7734" width="8.3333" x="760.0159" y="169.0104"/><line style="stroke:#000080;stroke-width:1.0417;stroke-dasharray:5.0,5.0;" x1="763.6302" x2="763.6302" y1="169.0104" y2="1186.7839"/></g><g><title>&lt;color:#000080&gt;Zenodo&lt;/color&gt;</title><rect fill="#FFFFFF" fill-opacity="0.00000" height="1017.7734" width="8.3333" x="998.9441" y="169.0104"/><line style="stroke:#000080;stroke-width:1.0417;stroke-dasharray:5.0,5.0;" x1="1002.3244" x2="1002.3244" y1="169.0104" y2="1186.7839"/></g><g><text fill="#000080" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="88.7085" x="36.4583" y="160.8541">Trusted Agent</text><ellipse cx="83.9376" cy="97.168" fill="#FFFFFF" fill-opacity="0.00000" rx="16.6667" ry="16.6667" style="stroke:#000080;stroke-width:1.0417;"/><path d="M83.9376,118.0013 C88.1042,118.0013 91.2292,118.0013 95.3959,113.8346 C103.7292,113.8346 112.0626,122.168 112.0626,130.5013 L112.0626,134.668 C112.0626,138.8346 107.8959,143.0013 103.7292,143.0013 L64.1459,143.0013 C59.9792,143.0013 55.8126,138.8346 55.8126,134.668 L55.8126,130.5013 C55.8126,122.168 64.1459,113.8346 72.4792,113.8346 C76.6459,118.0013 79.7709,118.0013 83.9376,118.0013 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000080;stroke-width:1.0417;"/></g><g><text fill="#000080" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="88.7085" x="36.4583" y="1202.5533">Trusted Agent</text><ellipse cx="83.9376" cy="1228.418" fill="#FFFFFF" fill-opacity="0.00000" rx="16.6667" ry="16.6667" style="stroke:#000080;stroke-width:1.0417;"/><path d="M83.9376,1249.2513 C88.1042,1249.2513 91.2292,1249.2513 95.3959,1245.0846 C103.7292,1245.0846 112.0626,1253.418 112.0626,1261.7513 L112.0626,1265.918 C112.0626,1270.0846 107.8959,1274.2513 103.7292,1274.2513 L64.1459,1274.2513 C59.9792,1274.2513 55.8126,1270.0846 55.8126,1265.918 L55.8126,1261.7513 C55.8126,1253.418 64.1459,1245.0846 72.4792,1245.0846 C76.6459,1249.2513 79.7709,1249.2513 83.9376,1249.2513 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000080;stroke-width:1.0417;"/></g><g><rect fill="#FFFFFF" height="39.5508" rx="4.1667" ry="4.1667" style="stroke:#000080;stroke-width:1.0417;" width="68.3167" x="333.6355" y="128.418"/><text fill="#000080" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="43.3167" x="346.1355" y="152.5208">GitHub</text></g><g><rect fill="#FFFFFF" height="39.5508" rx="4.1667" ry="4.1667" style="stroke:#000080;stroke-width:1.0417;" width="68.3167" x="333.6355" y="1185.7422"/><text fill="#000080" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="43.3167" x="346.1355" y="1209.845">GitHub</text></g><g><rect fill="#FFFFFF" height="39.5508" rx="4.1667" ry="4.1667" style="stroke:#000080;stroke-width:1.0417;" width="110.6262" x="569.6706" y="128.418"/><text fill="#000080" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="85.6262" x="582.1706" y="152.5208">CSV Validator</text></g><g><rect fill="#FFFFFF" height="39.5508" rx="4.1667" ry="4.1667" style="stroke:#000080;stroke-width:1.0417;" width="110.6262" x="569.6706" y="1185.7422"/><text fill="#000080" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="85.6262" x="582.1706" y="1209.845">CSV Validator</text></g><g><text fill="#000080" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="88.6047" x="716.7552" y="146.3033">OpenCitations</text><text fill="#000080" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="69.8792" x="726.118" y="160.8541">Index/Meta</text><path d="M745.4325,91.9922 C745.4325,81.5755 764.1825,81.5755 764.1825,81.5755 C764.1825,81.5755 782.9325,81.5755 782.9325,91.9922 L782.9325,119.0755 C782.9325,129.4922 764.1825,129.4922 764.1825,129.4922 C764.1825,129.4922 745.4325,129.4922 745.4325,119.0755 L745.4325,91.9922 " fill="url(#g11uxd1q54az3m0)" style="stroke:#2FA4E7;stroke-width:1.5625;"/><path d="M745.4325,91.9922 C745.4325,102.4089 764.1825,102.4089 764.1825,102.4089 C764.1825,102.4089 782.9325,102.4089 782.9325,91.9922 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#2FA4E7;stroke-width:1.5625;"/></g><g><text fill="#000080" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="88.6047" x="716.7552" y="1202.5533">OpenCitations</text><text fill="#000080" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="69.8792" x="726.118" y="1217.1041">Index/Meta</text><path d="M745.4325,1235.6771 C745.4325,1225.2604 764.1825,1225.2604 764.1825,1225.2604 C764.1825,1225.2604 782.9325,1225.2604 782.9325,1235.6771 L782.9325,1262.7604 C782.9325,1273.1771 764.1825,1273.1771 764.1825,1273.1771 C764.1825,1273.1771 745.4325,1273.1771 745.4325,1262.7604 L745.4325,1235.6771 " fill="url(#g11uxd1q54az3m0)" style="stroke:#2FA4E7;stroke-width:1.5625;"/><path d="M745.4325,1235.6771 C745.4325,1246.0938 764.1825,1246.0938 764.1825,1246.0938 C764.1825,1246.0938 782.9325,1246.0938 782.9325,1235.6771 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#2FA4E7;stroke-width:1.5625;"/></g><g><text fill="#000080" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="47.406" x="976.2828" y="160.8541">Zenodo</text><path d="M984.3608,106.543 C984.3608,96.1263 1003.1108,96.1263 1003.1108,96.1263 C1003.1108,96.1263 1021.8608,96.1263 1021.8608,106.543 L1021.8608,133.6263 C1021.8608,144.043 1003.1108,144.043 1003.1108,144.043 C1003.1108,144.043 984.3608,144.043 984.3608,133.6263 L984.3608,106.543 " fill="url(#g11uxd1q54az3m0)" style="stroke:#2FA4E7;stroke-width:1.5625;"/><path d="M984.3608,106.543 C984.3608,116.9596 1003.1108,116.9596 1003.1108,116.9596 C1003.1108,116.9596 1021.8608,116.9596 1021.8608,106.543 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#2FA4E7;stroke-width:1.5625;"/></g><g><text fill="#000080" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="47.406" x="976.2828" y="1202.5533">Zenodo</text><path d="M984.3608,1221.1263 C984.3608,1210.7096 1003.1108,1210.7096 1003.1108,1210.7096 C1003.1108,1210.7096 1021.8608,1210.7096 1021.8608,1221.1263 L1021.8608,1248.2096 C1021.8608,1258.6263 1003.1108,1258.6263 1003.1108,1258.6263 C1003.1108,1258.6263 984.3608,1258.6263 984.3608,1248.2096 L984.3608,1221.1263 " fill="url(#g11uxd1q54az3m0)" style="stroke:#2FA4E7;stroke-width:1.5625;"/><path d="M984.3608,1221.1263 C984.3608,1231.543 1003.1108,1231.543 1003.1108,1231.543 C1003.1108,1231.543 1021.8608,1231.543 1021.8608,1221.1263 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#2FA4E7;stroke-width:1.5625;"/></g><g><title>&lt;color:#000080&gt;OpenCitations&lt;/color&gt;</title><rect fill="#FFFFFF" fill-opacity="0.00000" height="121.7448" style="stroke:#000080;stroke-width:1.0417;" width="10.4167" x="758.9742" y="882.8776"/></g><rect fill="#F8F9FA" height="3.125" rx="4.1667" ry="4.1667" style="stroke:#F8F9FA;stroke-width:1.0417;" width="1214.5793" x="10.4167" y="205.4525"/><line style="stroke:#868E96;stroke-width:1.0417;" x1="10.4167" x2="1224.9959" y1="205.4525" y2="205.4525"/><line style="stroke:#868E96;stroke-width:1.0417;" x1="10.4167" x2="1224.9959" y1="208.5775" y2="208.5775"/><rect fill="#F8F9FA" height="33.3008" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:2.0833;" width="151.4221" x="541.9952" y="189.8438"/><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="122.0703" x="553.4536" y="210.8215">Issue Submission</text><g><polygon fill="#000080" points="355.2938,318.8151,365.7104,322.9818,355.2938,327.1484,359.4604,322.9818" style="stroke:#000080;stroke-width:1.0417;"/><line style="stroke:#000080;stroke-width:3.125;" x1="83.9376" x2="361.5438" y1="322.9818" y2="322.9818"/><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="8.6975" x="96.4376" y="283.6405">1</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="112.5977" x="119.7184" y="254.539">Create issue with:</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="107.6965" x="119.7184" y="269.0898">1. "deposit" label</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="109.552" x="119.7184" y="283.6405">2. Formatted title</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="104.2786" x="119.7184" y="298.1913">3. Metadata CSV</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="100.3052" x="119.7184" y="312.7421">4. Citations CSV</text></g><rect fill="#F8F9FA" height="3.125" rx="4.1667" ry="4.1667" style="stroke:#F8F9FA;stroke-width:1.0417;" width="1214.5793" x="10.4167" y="357.3405"/><line style="stroke:#868E96;stroke-width:1.0417;" x1="10.4167" x2="1224.9959" y1="357.3405" y2="357.3405"/><line style="stroke:#868E96;stroke-width:1.0417;" x1="10.4167" x2="1224.9959" y1="360.4655" y2="360.4655"/><rect fill="#F8F9FA" height="33.3008" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:2.0833;" width="147.9248" x="543.7439" y="341.7318"/><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="118.573" x="555.2022" y="362.7096">Validation Phase</text><g><polygon fill="#000080" points="612.4837,422.9004,622.9004,427.0671,612.4837,431.2337,616.6504,427.0671" style="stroke:#000080;stroke-width:1.0417;"/><line style="stroke:#000080;stroke-width:3.125;" x1="367.7938" x2="618.7337" y1="427.0671" y2="427.0671"/><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="8.6975" x="380.2938" y="416.8274">2</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="170.4285" x="403.5746" y="416.8274">Trigger validation workflow</text></g><path d="M629.1667,394.8242 L629.1667,435.4492 A4.1667,4.1667 0 0 0 633.3333,439.6159 L819.7917,439.6159 A4.1667,4.1667 0 0 0 823.9583,435.4492 L823.9583,401.0742 L813.5417,390.6576 L633.3333,390.6576 A4.1667,4.1667 0 0 0 629.1667,394.8242 " fill="#ECECFD" style="stroke:#000080;stroke-width:1.0417;"/><path d="M813.5417,390.6576 L813.5417,398.9909 A2.0833,2.0833 0 0 0 815.625,401.0742 L823.9583,401.0742 L813.5417,390.6576 " fill="#ECECFD" style="stroke:#000080;stroke-width:1.0417;"/><text fill="#000000" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="163.0066" x="640.625" y="412.677">Checks user authorization</text><text fill="#000000" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="101.5442" x="640.625" y="427.2278">and data format</text><path d="M25,453.0924 L96.8201,453.0924 L96.8201,469.7266 L86.4034,480.1432 L20.8333,480.1432 L20.8333,457.2591 A4.1667,4.1667 0 0 1 25,453.0924 " fill="#E9ECEF" style="stroke:#868E96;stroke-width:1.0417;"/><rect fill="#FFFFFF" fill-opacity="0.00000" height="302.7995" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0417;" width="690.7135" x="20.8333" y="453.0924"/><text fill="#033C73" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="18.6951" x="41.6667" y="470.9452">alt</text><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="96.6492" x="117.6534" y="471.9869">[Invalid Data]</text><g><polygon fill="#000080" points="379.2521,531.0872,368.8354,535.2539,379.2521,539.4206,375.0854,535.2539" style="stroke:#000080;stroke-width:1.0417;"/><line style="stroke:#000080;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="373.0021" x2="623.9421" y1="535.2539" y2="535.2539"/><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="8.6975" x="390.7104" y="517.7389">3</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="115.4297" x="413.9913" y="510.4635">Add "invalid" label</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="198.4924" x="413.9913" y="525.0142">Comment with validation errors</text></g><g><polygon fill="#000080" points="95.3959,570.638,84.9792,574.8047,95.3959,578.9714,91.2292,574.8047" style="stroke:#000080;stroke-width:1.0417;"/><line style="stroke:#000080;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="89.1459" x2="366.7521" y1="574.8047" y2="574.8047"/><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="8.6975" x="106.8542" y="564.565">4</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="146.4172" x="130.1351" y="564.565">Notify validation failure</text></g><line style="stroke:#2FA4E7;stroke-width:1.0417;stroke-dasharray:2.0,2.0;" x1="20.8333" x2="711.5468" y1="584.1797" y2="584.1797"/><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="143.0054" x="31.25" y="600.9908">[Unauthorized User]</text><g><polygon fill="#000080" points="379.2521,637.2396,368.8354,641.4063,379.2521,645.5729,375.0854,641.4063" style="stroke:#000080;stroke-width:1.0417;"/><line style="stroke:#000080;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="373.0021" x2="623.9421" y1="641.4063" y2="641.4063"/><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="8.6975" x="390.7104" y="631.1666">5</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="125.4883" x="413.9913" y="631.1666">Add "rejected" label</text></g><g><polygon fill="#000080" points="95.3959,676.7904,84.9792,680.957,95.3959,685.1237,91.2292,680.957" style="stroke:#000080;stroke-width:1.0417;"/><line style="stroke:#000080;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="89.1459" x2="366.7521" y1="680.957" y2="680.957"/><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="8.6975" x="106.8542" y="670.7174">6</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="225.1587" x="130.1351" y="670.7174">Request contact with OpenCitations</text></g><line style="stroke:#2FA4E7;stroke-width:1.0417;stroke-dasharray:2.0,2.0;" x1="20.8333" x2="711.5468" y1="690.332" y2="690.332"/><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="84.6252" x="31.25" y="707.1431">[Valid Data]</text><g><polygon fill="#000080" points="379.2521,743.3919,368.8354,747.5586,379.2521,751.7253,375.0854,747.5586" style="stroke:#000080;stroke-width:1.0417;"/><line style="stroke:#000080;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="373.0021" x2="623.9421" y1="747.5586" y2="747.5586"/><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="8.6975" x="390.7104" y="737.3189">7</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="174.1516" x="413.9913" y="737.3189">Add "to be processed" label</text></g><rect fill="#F8F9FA" height="3.125" rx="4.1667" ry="4.1667" style="stroke:#F8F9FA;stroke-width:1.0417;" width="1214.5793" x="10.4167" y="789.209"/><line style="stroke:#868E96;stroke-width:1.0417;" x1="10.4167" x2="1224.9959" y1="789.209" y2="789.209"/><line style="stroke:#868E96;stroke-width:1.0417;" x1="10.4167" x2="1224.9959" y1="792.334" y2="792.334"/><rect fill="#F8F9FA" height="33.3008" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:2.0833;" width="152.9297" x="541.2415" y="773.6003"/><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="123.5779" x="552.6998" y="794.578">Processing Phase</text><path d="M306.5521,824.6094 L498.0743,824.6094 L498.0743,841.2435 L487.6577,851.6602 L302.3855,851.6602 L302.3855,828.776 A4.1667,4.1667 0 0 1 306.5521,824.6094 " fill="#E9ECEF" style="stroke:#868E96;stroke-width:1.0417;"/><rect fill="#FFFFFF" fill-opacity="0.00000" height="188.3464" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0417;" width="652.5116" x="302.3855" y="824.6094"/><text fill="#033C73" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="138.3972" x="323.2188" y="842.4622">Monthly Processing</text><g><polygon fill="#000080" points="746.4742,878.7109,756.8909,882.8776,746.4742,887.0443,750.6409,882.8776" style="stroke:#000080;stroke-width:1.0417;"/><line style="stroke:#000080;stroke-width:3.125;" x1="367.7938" x2="752.7242" y1="882.8776" y2="882.8776"/><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="8.6975" x="380.2938" y="872.6379">8</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="138.4033" x="403.5746" y="872.6379">Process valid deposits</text></g><g><line style="stroke:#000080;stroke-width:3.125;" x1="769.3909" x2="813.1409" y1="936.9792" y2="936.9792"/><line style="stroke:#000080;stroke-width:3.125;" x1="813.1409" x2="813.1409" y1="936.9792" y2="950.5208"/><line style="stroke:#000080;stroke-width:3.125;" x1="770.4325" x2="813.1409" y1="950.5208" y2="950.5208"/><polygon fill="#000080" points="780.8492,946.3542,770.4325,950.5208,780.8492,954.6875,776.6825,950.5208" style="stroke:#000080;stroke-width:1.0417;"/><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="8.6975" x="781.8909" y="919.4641">9</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="121.6003" x="805.1717" y="912.1887">Ingest citation data</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="88.0737" x="805.1717" y="926.7395">and metadata</text></g><g><polygon fill="#000080" points="379.2521,1000.4557,368.8354,1004.6224,379.2521,1008.7891,375.0854,1004.6224" style="stroke:#000080;stroke-width:1.0417;"/><line style="stroke:#000080;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="373.0021" x2="763.1409" y1="1004.6224" y2="1004.6224"/><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="17.395" x="390.7104" y="987.1073">10</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="105.2917" x="422.6888" y="979.8319">Add "done" label</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="70.1355" x="422.6888" y="994.3827">Close issue</text></g><rect fill="#F8F9FA" height="3.125" rx="4.1667" ry="4.1667" style="stroke:#F8F9FA;stroke-width:1.0417;" width="1214.5793" x="10.4167" y="1046.2728"/><line style="stroke:#868E96;stroke-width:1.0417;" x1="10.4167" x2="1224.9959" y1="1046.2728" y2="1046.2728"/><line style="stroke:#868E96;stroke-width:1.0417;" x1="10.4167" x2="1224.9959" y1="1049.3978" y2="1049.3978"/><rect fill="#F8F9FA" height="33.3008" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:2.0833;" width="133.4167" x="550.9979" y="1030.6641"/><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="104.0649" x="562.4563" y="1051.6418">Archival Phase</text><path d="M705.2968,1081.6732 L877.3061,1081.6732 L877.3061,1098.3073 L866.8894,1108.724 L701.1302,1108.724 L701.1302,1085.8398 A4.1667,4.1667 0 0 1 705.2968,1081.6732 " fill="#E9ECEF" style="stroke:#868E96;stroke-width:1.0417;"/><rect fill="#FFFFFF" fill-opacity="0.00000" height="87.4023" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0417;" width="513.4491" x="701.1302" y="1081.6732"/><text fill="#033C73" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="118.8843" x="721.9635" y="1099.526">Monthly Archival</text><g><polygon fill="#000080" points="990.6108,1146.1751,1001.0274,1150.3418,990.6108,1154.5085,994.7774,1150.3418" style="stroke:#000080;stroke-width:1.0417;"/><line style="stroke:#000080;stroke-width:3.125;" x1="764.1825" x2="996.8608" y1="1150.3418" y2="1150.3418"/><text fill="#343A40" font-family="Arial" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="17.395" x="776.6825" y="1140.1021">11</text><text fill="#343A40" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="171.5332" x="808.6609" y="1140.1021">Archive processed deposits</text></g><path d="M1007.2917,1118.099 L1007.2917,1158.724 A4.1667,4.1667 0 0 0 1011.4583,1162.8906 L1193.75,1162.8906 A4.1667,4.1667 0 0 0 1197.9167,1158.724 L1197.9167,1124.349 L1187.5,1113.9323 L1011.4583,1113.9323 A4.1667,4.1667 0 0 0 1007.2917,1118.099 " fill="#ECECFD" style="stroke:#000080;stroke-width:1.0417;"/><path d="M1187.5,1113.9323 L1187.5,1122.2656 A2.0833,2.0833 0 0 0 1189.5833,1124.349 L1197.9167,1124.349 L1187.5,1113.9323 " fill="#ECECFD" style="stroke:#000080;stroke-width:1.0417;"/><text fill="#000000" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="158.3435" x="1018.75" y="1135.9517">Preserves deposit history</text><text fill="#000000" font-family="Arial" font-size="12.5" lengthAdjust="spacing" textLength="101.3672" x="1018.75" y="1150.5025">and provenance</text><!--SRC=[nLLBRnCn4BxlhnZI0wS-U1nGH2kbsnOg0Oqe50dbubrFigPUEzZUfW7ntnbx7_6MJTi3WXoYnFFwvflnvoUkm18XHrD9P6fNLquAXKbYhuLQCiDAo5X-lJ2wKZpLKXjO5S9XPESuPvLqPrgv3unoJOnWChApt6bpwTOIWQtGwZ8EfcydSh5aoaqPvq8juFb1N5pVjkVFudFhqA1swoNwkZMmdGFwl3f8agUGLjPfxqLLRHo6tojKESBF1EWpCKQl-i7Xs2C-reQZ-TFuJipn7L6qpJxTTFGObq5olTEnldr4_9_TTmqCcqwOOncpUB_ryXvwVtc28mWMLi8LaA6Z8CZ9tp3haZ1s67qoD0haC5cWSYDW5ZvRD4aqTtWZtDigwnsDqiihk69IS4PPGbZtB-4DI1YzpZsoSOFiw6A9AXMEEQ6LVRqVZ4SpTSVhN76ytN-FZhKk8Vz5sdQuNmzXQvclg3JNlU3ww4w2pHu6Jmjp8gIXoI3ZB1DIkFNTgzBivdsRCRmMmoDzO9I3L_5_GUWe_tVrswXQe38j-J2auuTKSEkz6iWrW3voKzfjOs3dD3rDpquUoK4cARpVZa-s_8lqzf8xuMIB_1wcnG_q8h-j4AMi4wKapjpgokHU_hzeSpsNUXLkKU-c9mchd5PLcP6m98U7S6vjXN1PPQMmbZpWy33ngWExHutOZ2avCg9P15SlOEEPUhO78uvBRGKfbMGPofbwlaUWJScS5x60QwPUx86N3pzE8A6QgPTxqA7n9m558rY-_hJmIqqewkeUHoTdO_Xan691w6us0QkcsIJi0jaBHv0BpAyjLBuJwhZGHlm8xZF550_RvSaXhCI8T72kGiOWwe7jhYRiHanCE8UHg7sxjbDTbYJOjRH7m91UJ6D3jhONIkN97SC7xSHy7NlFcP2LmGGbjVzPjQ29oV08F839u3VCYVO6r73HZ_v5jowyEoIVDU3-UeJgLu-cmcaIQLWQdQErc-geU1Zhj3RubUp6Mj-gzmIXaEl8emVvY9wOSMkiMO9cssf22RwuyKjvaOR_z28rGUTg4NfiMWgZheTUDdlO1TpjXck5cwbARPkT3m4SuvfjXnEJ5tGej_NNsYEGzVitRamHU_qEussU6gG1tg1jNQ0Gz5YQTTqOPRX1-fMZn_KR]--></g></svg>

- Rilettura, refactor e test del codice da lanciare sul server per scaricare i dati e processarli.

```
markdown
crowdsourcing_ingestion_data/
└── YYYY_MM/
    ├── metadata/
    ├── citations/
```

- Le issue vengono ingerite una alla volta, in modo che la source sia la issue stessa.
- Nuova label: oc meta error
- Mocking/Patching
    - Problema: isolare il codice che stiamo testando dalle sue dipendenze esterne (API; database, filesystem, servizi esterni)
    - Soluzione
        - Mock: oggetto che simula il comportamento di un oggetto reale
        
        ```python
        # 1 Registra le chiamate:
        
        mock = Mock()
        mock.some_method(1, 2, key="value")
        
        # Possiamo verificare che è stato chiamato
        mock.some_method.assert_called_once()
        
        # Possiamo verificare con quali argomenti
        mock.some_method.assert_called_with(1, 2, key="value")
        
        # Possiamo vedere quante volte è stato chiamato
        print(mock.some_method.call_count)  # Output: 1
        
        # 2. Può restituire valori specifici:
        
        mock = Mock(return_value="hello")
        result = mock()
        print(result)  # Output: "hello"
        
        # O con side_effect per valori multipli o eccezioni
        mock.side_effect = [1, 2, 3]  # Restituirà 1, poi 2, poi 3
        # oppure
        mock.side_effect = Exception("error")  # Solleverà un'eccezione
        ```
        
    - **Patch:** è un decoratore/context manager che temporaneamente sostituisce un oggetto con un Mock
        
        ```python
        @patch('requests.delete')
        @patch('requests.post')
        def test_successful_update_on_success(self, mock_post, mock_delete):
            # 1. Setup dei mock
            mock_delete.return_value.status_code = 200  # Simuliamo una risposta di successo
            mock_post.return_value.status_code = 201    # Simuliamo una risposta di successo
        
            # 2. Chiamata alla funzione da testare
            update_issue_labels("123", success=True)
        
            # 3. Verifica delle chiamate
            mock_delete.assert_called_once_with(
                "https://api.github.com/repos/test/repo/issues/123/labels/to%20be%20processed",
                headers=self.headers,
                timeout=30
            )
        ```
        
- Creato il crontab su ServerGrosso
- Il responsible agent è una roba tipo [https://api.github.com/user/42008604](https://api.github.com/user/42008604)
- Ho implementato un sistema di archiviazione automatica per i report di validazione basato su file di configurazione (https://github.com/opencitations/crowdsourcing/blob/main/archive_config.yaml). È possibile definire:
    - La frequenza di archiviazione.
    - Il numero di report necessari per attivare l'archiviazione.
    - Quanti report archiviare in una singola operazione su Zenodo.
    - Una serie di metadati di base.
    
    Quando viene raggiunto il numero massimo di report, l'archiviazione su Zenodo parte automaticamente. I link nelle issue (https://github.com/arcangelo7/crowdsourcing/issues/35) rimangono funzionanti perché puntano a una pagina HTML unica (https://github.com/opencitations/crowdsourcing/blob/main/docs/validation_reports/index.html), che legge un parametro `report` per identificare il file. Un indice (https://github.com/arcangelo7/crowdsourcing/blob/main/docs/validation_reports/index.json) tiene traccia sia dei report su GitHub che di quelli archiviati su Zenodo. Per i report su Zenodo, l'indice memorizza due URL:
    
    1. L'URL diretto dell'API di Zenodo per accedere immediatamente al contenuto del file
    2. Il DOI del record come fallback nel caso l'accesso diretto non sia disponibile
    
    I report di validazione contengono l'id della issue nel nome (es. validation_issue_42.html), per essere facilmente ritrovabili e per mantenere il collegamento con la issue originale.
    
    Quando un utente accede a un report attraverso il link in una issue, la pagina HTML:
    
    1. Legge il parametro report dall'URL
    2. Consulta l'indice per determinare la posizione del file
    3. Se il file è su GitHub, reindirizza direttamente all'URL di GitHub
    4. Se il file è su Zenodo:
        - Scarica automaticamente il file usando l'URL diretto dell'API
        - Reindirizza l'utente alla pagina del record su Zenodo, dove può trovare metadati e contesto aggiuntivi
        - Se l'accesso diretto fallisce, usa il DOI come fallback
- GitHub Action Concurrency: https://docs.github.com/en/actions/writing-workflows/choosing-what-your-workflow-does/control-the-concurrency-of-workflows-and-jobs
- Test locale GitHub Action: https://github.com/nektos/act
    - Si può anche specificare un payload per triggerare i workflow che dipendono, ad esempio, dall’apertura di un issue
        
        ```json
        {
          "action": "opened",
          "issue": {
            "number": 1,
            "title": "deposit localhost:330 doi:10.1007/978-3-662-07918-8_3",
            "body": "\"id\",\"title\",\"author\",\"pub_date\",\"venue\",\"volume\",\"issue\",\"page\",\"type\",\"publisher\",\"editor\"\n\"doi:10.1007/978-3-662-07918-8_3\",\"Influence of Dielectric Properties, State, and Electrodes on Electric Strength\",\"Ushakov, Vasily Y.\",\"2004\",\"Insulation of High-Voltage Equipment [isbn:9783642058530 isbn:9783662079188]\",\"\",\"\",\"27-82\",\"book chapter\",\"Springer Science and Business Media LLC [crossref:297]\",\"\"\n\"doi:10.1016/0021-9991(73)90147-2\",\"Flux-corrected transport. I. SHASTA, a fluid transport algorithm that works\",\"Boris, Jay P; Book, David L\",\"1973-01\",\"Journal of Computational Physics [issn:0021-9991]\",\"11\",\"1\",\"38-69\",\"journal article\",\"Elsevier BV [crossref:78]\",\"\"\n\"doi:10.1109/20.877674\",\"An investigation of FEM-FCT method for streamer corona simulation\",\"Woong-Gee Min, ; Hyeong-Seok Kim, ; Seok-Hyun Lee, ; Song-Yop Hahn, \",\"2000-07\",\"IEEE Transactions on Magnetics [issn:0018-9464]\",\"36\",\"4\",\"1280-1284\",\"journal article\",\"Institute of Electrical and Electronics Engineers (IEEE) [crossref:263]\",\"\"\n\"doi:10.1109/tps.2003.815469\",\"Numerical study on influences of barrier arrangements on dielectric barrier discharge characteristics\",\"Woo Seok Kang, ; Jin Myung Park, ; Yongho Kim, ; Sang Hee Hong, \",\"2003-08\",\"IEEE Transactions on Plasma Science [issn:0093-3813]\",\"31\",\"4\",\"504-510\",\"journal article\",\"Institute of Electrical and Electronics Engineers (IEEE) [crossref:263]\",\"\"\n\"\",\"Spatial Distribution of Ion Current Around HVDC Bundle Conductors\",\"Zhou, Xiangxian; Cui, Xiang; Lu, Tiebing; Fang, Chao; Zhen, Yongzan\",\"2012-01\",\"IEEE Transactions on Power Delivery [issn:0885-8977 issn:1937-4208]\",\"27\",\"1\",\"380-390\",\"journal article\",\"Institute of Electrical and Electronics Engineers (IEEE) [crossref:263]\",\"\"\n\"doi:10.1007/978-1-4615-3786-1_11\",\"The Solution of the Continuity Equations in Ionization and Plasma Growth\",\"Davies, A. J.; Niessen, W.\",\"1990\",\"Physics and Applications of Pseudosparks [isbn:9781461366874 isbn:9781461537861]\",\"\",\"\",\"197-217\",\"book chapter\",\"Springer Science and Business Media LLC [crossref:297]\",\"\"\n\"doi:10.1088/0022-3727/13/1/002\",\"Discharge current induced by the motion of charged particles\",\"Sato, N\",\"1980-01-14\",\"Journal of Physics D: Applied Physics [issn:0022-3727 issn:1361-6463]\",\"13\",\"1\",\"3-6\",\"journal article\",\"IOP Publishing [crossref:266]\",\"\"\n\"doi:10.1109/27.106800\",\"Particle-in-cell charged-particle simulations, plus Monte Carlo collisions with neutral atoms, PIC-MCC\",\"Birdsall, C.K.\",\"1991-04\",\"IEEE Transactions on Plasma Science [issn:0093-3813]\",\"19\",\"2\",\"65-85\",\"journal article\",\"Institute of Electrical and Electronics Engineers (IEEE) [crossref:263]\",\"\"\n\"doi:10.1016/0021-9991(79)90051-2\",\"Fully multidimensional flux-corrected transport algorithms for fluids\",\"Zalesak, Steven T\",\"1979-06\",\"Journal of Computational Physics [issn:0021-9991]\",\"31\",\"3\",\"335-362\",\"journal article\",\"Elsevier BV [crossref:78]\",\"\"\n\"doi:10.1088/0022-3727/39/14/017\",\"Diffusion correction to the Raether–Meek criterion for the avalanche-to-streamer transition\",\"Montijn, Carolynne; Ebert, Ute [orcid:0000-0003-3891-6869]\",\"2006-06-30\",\"Journal of Physics D: Applied Physics [issn:0022-3727 issn:1361-6463]\",\"39\",\"14\",\"2979-2992\",\"journal article\",\"IOP Publishing [crossref:266]\",\"\"\n\"doi:10.1007/978-3-663-14090-0 isbn:9783528085995 isbn:9783663140900\",\"High-Voltage Insulation Technology\",\"Kind, Dieter; Kärner, Hermann\",\"1985\",\"\",\"\",\"\",\"\",\"book\",\"Springer Science and Business Media LLC [crossref:297]\",\"\"\n\"\",\"Space-charge effects in high-density plasmas\",\"Morrow, R\",\"1982-06\",\"Journal of Computational Physics [issn:0021-9991]\",\"46\",\"3\",\"454-461\",\"journal article\",\"Elsevier BV [crossref:78]\",\"\"\n\"doi:10.1007/s42835-022-01029-y\",\"Numerical Simulation of Gas Discharge Using SUPG-FEM-FCT Method with Adaptive Mesh Refinement\",\"Choi, Chan Young; Park, Il Han [orcid:0000-0002-9383-6856]\",\"2022-02-28\",\"Journal of Electrical Engineering & Technology [issn:1975-0102 issn:2093-7423]\",\"17\",\"3\",\"1873-1881\",\"journal article\",\"Springer Science and Business Media LLC [crossref:297]\",\"\"\n===###===@@@===\n\"citing_id\",\"cited_id\"\n\"doi:10.1007/s42835-022-01029-y\",\"doi:10.1007/978-3-662-07918-8_3\"\n\"doi:10.1007/s42835-022-01029-y\",\"doi:10.1016/0021-9991(73)90147-2\"\n\"doi:10.1007/s42835-022-01029-y\",\"doi:10.1109/20.877674\"\n\"doi:10.1007/s42835-022-01029-y\",\"doi:10.1109/tps.2003.815469\"\n\"doi:10.1007/s42835-022-01029-y\",\"doi:10.1109/tpwrd.2011.2172694\"\n\"doi:10.1007/s42835-022-01029-y\",\"doi:10.1007/978-1-4615-3786-1_11\"\n\"doi:10.1007/s42835-022-01029-y\",\"doi:10.1088/0022-3727/13/1/002\"\n\"doi:10.1007/s42835-022-01029-y\",\"doi:10.1109/27.106800\"\n\"doi:10.1007/s42835-022-01029-y\",\"doi:10.1016/0021-9991(79)90051-2\"\n\"doi:10.1007/s42835-022-01029-y\",\"doi:10.1088/0022-3727/39/14/017\"\n\"doi:10.1007/s42835-022-01029-y\",\"doi:10.1007/978-3-663-14090-0\"\n\"doi:10.1007/s42835-022-01029-y\",\"doi:10.1016/0021-9991(82)90026-2\"",
            "labels": [
              {
                "name": "deposit"
              }
            ]
          }
        }
        ```
        

## Domande

- Gli facciamo fare i test su opencitations/crowdsourcing o su arcangelo7/crowsourcing?
- Che prefisso usiamo per il crowdsourcing?