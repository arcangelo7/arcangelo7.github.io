---
title: "2022-03-02"
editUrl: false
---

## Cosa ho fatto

1. NovitÃ  relative al codice per preparare il multiprocessing:
   1. Nuove classi [**RespAgentsCurator**](https://github.com/opencitations/meta/blob/master/plugins/multiprocess/resp_agents_curator.py) e [**RespAgentsCreator**](https://github.com/opencitations/meta/blob/master/plugins/multiprocess/resp_agents_creator.py), figlie rispettivamente di Curator e Creator, che si occupano processare solo il campo â€˜**author**â€™ e di generare **solo** le **triple** relative agli **agenti responsabili**.
      1. In questo modo non Ã¨ piÃ¹ necessario cancellare le triple vuote su ruoli di agente e risorse bibliografiche, con relativi problemi di provenance e tempi di esecuzione.
      2. Inoltre, i contatori relativi a ruoli di gente e risorse bibliografiche non vengono toccati.
      3. RespAgentsCurator ha molte meno responsabilitÃ  di Curator ed Ã¨ di conseguenza piÃ¹ rapido.
      4. RespAgentsCurator Ã¨ stato **testato**, \*\*\*\*sia in caso di nuovo agente responsabile, che in caso di agente responsabile giÃ  esistente sul triplestore. Anche RespAgentsCreator Ã¨ stato testato.
   2. **Volumi** e **issues** vengono **preprocessati** da Meta.
      1. CiÃ² avviene solo se Ã¨ nota la rivista e la rivista ha un id.
         1. La rivista puÃ² comparire indifferentemente in una riga con â€œtypeâ€ uguale a â€œjournalâ€, â€œjournal articleâ€, â€œjournal issueâ€ o â€œjournal volumeâ€.
      2. In fase di deduplicazione delle riviste vengono deduplicati anche volumi e issues associati, preservando le informazioni di contenimento sulla base del numero sequenziale di volume e issue.
      3. La tabella in input per Meta viene strutturata in modo tale da veicolare tutte le informazioni di contenimento tra issue, volume e rivista.

         | id                            | title                  | author | pub\_date | venue                                              | volume | issue | page | **type**       | publisher | editor |
         | ----------------------------- | ---------------------- | ------ | --------- | -------------------------------------------------- | ------ | ----- | ---- | -------------- | --------- | ------ |
         |                               |                        |        |           | Physical Review B \[issn:1095-3795 issn:0163-1829] | 65     | 4     |      | journal issue  |           |        |
         |                               |                        |        |           | Physical Review B \[issn:1095-3795 issn:0163-1829] |        | 5     |      | journal issue  |           |        |
         |                               |                        |        |           | Physical Review B \[issn:1095-3795 issn:0163-1829] | 2      |       |      | journal volume |           |        |
         | issn:1651-2251 issn:0001-6489 | Acta Oto-Laryngologica |        |           |                                                    |        |       |      | journal        |           |        |

         1. La rivista viene specificata nel campo â€œvenueâ€, il volume nel campo â€œvolumeâ€ e lâ€™issue nel campo â€œissueâ€.
         2. Se un issue Ã¨ direttamente contenuta nella rivista, il campo â€œtypeâ€ ha valore â€œjournal issueâ€ e il campo â€œvolumeâ€ Ã¨ vuoto.
         3. Se unâ€™issue Ã¨ compresa dentro un volume, entrambi i campi sono pieni e il campo â€œtypeâ€ ha valore â€œjournal issueâ€.
         4. Il campo â€œtypeâ€ ha valore â€œjournal volumeâ€ solo se la riga contiene una rivista, un volume ma non un issue.
         5. Infine, la rivista ha una sua riga dedicata solo nel caso in cui non siano noti volumi o issue per quella rivista. In tal caso, gli id della rivista compaiono nel campo â€œidâ€, il nome del campo â€œtitleâ€ e il campo â€œtypeâ€ ha valore â€œjournalâ€.
      4. Corretto un **bug** in Curator, per cui i campi â€œvolumeâ€ e â€œissueâ€ venivano ignorati nel caso in cui il tipo fosse â€œjournal volumeâ€ o â€œjournal issueâ€ (vedere punto 1. della sezione *Domande* di oggi per approfondire).
      5. Corretto un **bug** in Creator. Le entitÃ  di tipo fabio:JournalIssue venivano create solo se il campo â€œtypeâ€ aveva valore â€œjournal articleâ€.
   3. Ho studiato il caso delle **risorse bibliografiche** che possono **contenerne altre**, ovvero le risorse di tipo archival document, book, book part, book section, book series, book set, edited book, monograph, proceedings series, proceedings, reference book, report series, standard series (escludendo journal, journal volume e journal issue di cui al punto 1.b).
      1. Queste risorse possono comparire nel campo venue per esprimere il loro ruolo di contenitori.
      2. In pratica, quando ciÃ² avviene, manca quasi sempre lâ€™id, per via di un problema discusso al punto 2 della sezione *Domande* di oggi.

## Domande

1. Per qualche motivo Meta cancellava il contenuto dei campi â€œvolumeâ€ e â€œissueâ€ nel caso in cui il tipo fosse â€œjournal volumeâ€ o â€œjournal issueâ€. Era un comportamento voluto? Io lâ€™ho rimosso, perchÃ© altrimenti non era possibile preprocessare volumi e issue senza perdere lâ€™informazione sul numero.

   Riporto il codice contrassegnando con â€œPerchÃ©?â€ le righe che cancellavano il contenuto di quei campi.

   [meta/curator.py at a910d04869345bd7dd4928cd3f276fbbe0973ece Â· opencitations/meta](https://github.com/opencitations/meta/blob/a910d04869345bd7dd4928cd3f276fbbe0973ece/scripts/curator.py#L140)

   ```python
   def clean_vvi(self, row:Dict[str, str]) -> None:
       vol_meta = None
       br_id = row['id']
       venue = row['venue']
       volume = row['volume']
       issue = row['issue']
       br_type = row['type']
       # Venue
       if venue:
   				# [...]
           # Volume
           if volume and (br_type == 'journal issue' or br_type == 'journal article'):
   						# [...]
           elif volume and br_type == 'journal volume':
               row['volume'] = '' # PerchÃ©?
               row['issue'] = ''  # PerchÃ©?
               vol_meta = br_id
               self.volume_issue(vol_meta, self.vvi[metaval]['volume'], volume, row)
           # Issue
           if issue and br_type == 'journal article':
   						# [...]
           elif issue and br_type == 'journal issue':
               row['issue'] = '' # PerchÃ©?
               issue_meta = br_id
               if vol_meta:
                   self.volume_issue(issue_meta, self.vvi[metaval]['volume'][volume]['issue'], issue, row)
               else:
                   self.volume_issue(issue_meta, self.vvi[metaval]['issue'], issue, row)
       else:
           row['venue'] = ''
           row['volume'] = ''
           row['issue'] = ''
   ```

2. Câ€™Ã¨ un problema in **crossref\_processing**, per cui lâ€™id di una venue viene salvato solo in specifiche condizioni, che perÃ² non sono sufficienti.

   [meta/crossref\_processing.py at 714de5089087438d820915782edb7491f52379cf Â· opencitations/meta](https://github.com/opencitations/meta/blob/714de5089087438d820915782edb7491f52379cf/plugins/crossref/crossref_processing.py#L179)

   ```python
   def get_venue_name(self, item:dict, row:dict) -> str:
       name_and_id = ''
       if 'container-title' in item:
           if item['container-title']:
   						# [...]
               venidlist = list()
               if 'ISBN' in item:
                   if row['type'] in {'book chapter', 'book part'}:
                       self.id_worker(item['ISBN'], venidlist, self.isbn_worker)

               if 'ISSN' in item:
                   if row['type'] in {'journal article', 'journal volume', 'journal issue'}:
                       self.id_worker(item['ISSN'], venidlist, self.issn_worker)
               if venidlist:
                   name_and_id = ventit + ' [' + ' '.join(venidlist) + ']'
               else:
                   name_and_id = ventit
       return name_and_id
   ```

   Come si vede, lâ€™ISSN della venue viene salvato solo se la risorsa Ã¨ di tipo journal article, journal volume o journal issue. Tuttavia, anche un libro o una monografia possono essere pubblicati da una venue con ISSN.

   1. Occorre definire, per tutti i tipi di risorsa bibliografica, quali sono gli id della venue ammissibili.

   2. Ecco le mie proposte di ampliamento (in maiuscolo le novitÃ  e tra parentesi il tipo di contenitore):
      1. **Lâ€™ISSN** Ã¨ ammesso come id della venue per risorse di tipo:
         * **book** (book series, book set)
         * **proceedings** (proceedings series â†’ series)
         * **\~\~proceedings article** (proceedings)\~\~
         * **reference book** (book series, book set),
         * **reference entry** (journal)
           * [10.1002/0471140856.tx1702s18](https://api.crossref.org/works/10.1002/0471140856.tx1702s18) (reference-entry) in [1934-9262](https://api.crossref.org/journals/1934-9254) (journal)
         * **report** (report series â†’ series)
         * journal article (journal)
         * journal issue (journal)
         * journal volume (journal)
           * Non ho considerato â€˜edited bookâ€™ e â€˜monographâ€™ perchÃ© Meta li trasforma in book. Allo stesso modo, Meta trasforma â€˜report seriesâ€™, â€˜standard seriesâ€™ e â€˜proceedings seriesâ€™ in â€˜seriesâ€™.
      2. L\*\*â€™ISBN\*\* Ã¨ ammesso come id della venue per risorse di tipo:
         * **book section** (book)
         * book chapter (book)
         * book part (book)
         * **book track** (book)
         * **reference entry** (reference book)

   3. Le risorse di tipo **report-series** (che Meta semplifica in series) sono un caso strano, perchÃ© possono essere contenute in unâ€™altra risorsa di tipo report-series, quindi lâ€™ISSN si puÃ² riferire sia al contenitore che al contenuto.

      Ad esempio, la risorsa *Teaching Strategies for Instructional Quality* Ã¨ una risorsa di tipo report-series contenuta dentro *OECD Education Working Papers*, che Ã¨ a sua volta una report-series. Lâ€™ISSN riportato da Crossref in questo caso si riferisce al contenitore, ma Meta lo processa come se fosse riferito al contenuto, introducendo un errore.

      Allo stesso modo, esiste la risorsa *OECD Education Working Papers* di tipo report-series, in cui lâ€™ISSN si riferisce alla risorsa stessa e non al contenitore.

       <aside>
       ðŸ’¡ **Propongo** allora la seguente **euristica**: se la risorsa Ã¨ di tipo report-series ed Ã¨ presente un ISSN, se il container-title Ã¨ vuoto lâ€™ISSN si riferisce alla risorsa stessa, altrimenti si riferisce alla venue. Va bene

       </aside>

   4. Restano fuori le risorse di tipo standard, dissertation, peer review e dataset, per le quali non Ã¨ prevista una venue.

3. Anche per quanto riguarda gli schemi ammessi per gli identificativi delle risorse crossref\_processing Ã¨ tropppo restrittivo:

   [meta/crossref\_processing.py at 714de5089087438d820915782edb7491f52379cf Â· opencitations/meta](https://github.com/opencitations/meta/blob/714de5089087438d820915782edb7491f52379cf/plugins/crossref/crossref_processing.py#L51)

   ```python
   if 'ISBN' in x:
   		if row['type'] in {'book', 'monograph', 'edited book'}:
   				self.id_worker(x['ISBN'], idlist, self.isbn_worker)
   if 'ISSN' in x:
       if row['type'] in {'journal', 'series', 'report series', 'standard series'}:
           self.id_worker(x['ISSN'], idlist, self.issn_worker)
   ```

   Lâ€™ISBN Ã¨ ammesso solo per risorse di tipo book, monograph ed edited book, mentre lâ€™ISSN solo per risorse di tipo journal, series, report series e standard series.

   Propongo i seguenti apliamenti, evidenziando in grassetto le novitÃ :

   1. L\*\*â€™ISSN\*\* Ã¨ ammesso come schema dellâ€™identificativo per risorse bibliografiche di tipo:
      * **book series**
      * **book set**
      * journal
      * **proceedings series**
      * report series
      * series
      * standard series
   2. Lâ€™**ISBN** Ã¨ ammesso come schema dellâ€™identificativo per risorse bibliografiche di tipo:
      * book
      * **dissertation (**e.g. \*\*\*\*[https://doi.org/10.14201/0VI0441](https://doi.org/10.14201/0VI0441)**)**
      * edited book
      * monograph
      * **reference book**
      * **report** (e.g. [10.14264/99aee1d](https://doi.org/10.14264/99aee1d))
      * **standard** (e.g. [10.1109/IEEESTD.2014.6849907](https://doi.org/10.1109/IEEESTD.2014.6849907))
   3. Non Ã¨ previsto nÃ© ISBN nÃ© ISSN per le risorse di tipo:
      * book-chapter
      * book-part
      * book-section
      * book-track
      * component
      * dataset
      * journal-article
      * journal-issue
      * journal-volume
      * other
      * peer-review
      * posted-content
      * ~~proceedings~~
      * proceedings-article
      * reference-entry
